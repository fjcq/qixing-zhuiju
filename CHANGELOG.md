# 七星追剧 更新日志

## v1.2.0 - 弹幕互动版本 (2025-08-03)

### 🆕 新增功能

#### 实时弹幕系统

- **核心功能**: 基于WebSocket的实时弹幕系统，支持观看同一视频的用户实时互动
- **多彩弹幕**: 支持7种颜色（白、红、黄、绿、青、蓝、紫）和3种大小（小、中、大）
- **智能房间**: 根据视频名称和集数自动分配弹幕房间，确保观看相同内容的用户在同一房间
- **快速输入**: 按回车键快速打开弹幕输入框（避免与双击全屏冲突）
- **一键开关**: 播放器控制栏提供弹幕开关按钮，可随时开启/关闭弹幕显示

#### 弹幕交互体验

- **回车发送**: 在弹幕输入框中按回车键快速发送弹幕
- **ESC关闭**: 按ESC键快速关闭弹幕输入框
- **本地标识**: 用户自己发送的弹幕带有绿色边框标识
- **智能轨道**: 10个弹幕轨道智能分配，避免弹幕重叠
- **平滑动画**: 8秒弹幕滚动动画，速度适中观看体验好

#### 服务器连接

- **多服务器**: 支持多个公共WebSocket服务器自动切换
- **断线重连**: 自动重连机制，网络异常时自动恢复连接
- **服务器切换**: 连接失败自动尝试下一个服务器

### 🔧 技术改进

#### 弹幕系统架构

- **模块化设计**: 独立的DanmakuSystem类，易于维护和扩展
- **WebSocket集成**: 使用原生WebSocket API连接公共服务器
- **CSS3动画**: 使用硬件加速的CSS动画，性能优异
- **性能优化**: 最多同时显示50条弹幕，超出自动清理

#### 播放器集成

- **无缝集成**: 弹幕系统完全集成到现有播放器中
- **生命周期管理**: 播放器初始化/销毁时自动管理弹幕系统
- **房间切换**: 切换视频时自动切换弹幕房间
- **资源清理**: 播放器关闭时自动清理弹幕资源

### 📁 新增文件

- `src/renderer/js/danmaku.js` - 弹幕系统核心逻辑
- `DANMAKU.md` - 弹幕功能详细说明文档
- `test-danmaku.js` - 弹幕功能测试脚本

### 🎨 界面更新

- 播放器顶部控制栏新增弹幕开关按钮（💬）
- 新增弹幕输入面板，支持颜色和大小选择
- 弹幕显示层覆盖在视频播放区域
- 响应式设计，支持移动端适配

### 💾 数据存储

- 弹幕开关状态自动保存到本地存储
- 用户ID自动生成并持久化保存
- 弹幕设置（颜色、大小偏好）记忆功能

### 🔒 安全特性

- 弹幕内容长度限制（100字符）
- 恶意内容过滤（防止XSS攻击）
- 用户唯一标识生成机制

### 📱 兼容性

- 支持全屏模式下的弹幕显示
- 兼容不同屏幕尺寸和分辨率
- 支持键盘快捷键操作

---

## v1.1.0 - 数据管理增强版本 (2024-12-XX)

### 🆕 新增功能

- 站点配置管理（添加/编辑/删除）
- 线路屏蔽和别名功能
- 配置导出/导入功能
- 数据迁移支持

### 🔧 技术改进

- 完善的错误处理机制
- 性能优化和内存管理
- GPU兼容性优化

---

## v1.0.0 - 初始版本 (2024-XX-XX)

### 🎬 核心功能

- 苹果CMS API支持
- 视频搜索和播放
- 播放历史记录
- 自动播放下一集
- 多窗口播放

### 🛠️ 技术栈

- Electron 27.x
- HLS.js视频播放
- 原生Web技术

---

## 🚀 下一版本计划

### v1.3.0 规划

- [ ] 弹幕内容过滤和举报功能
- [ ] 弹幕历史记录查看
- [ ] 自定义弹幕样式和特效
- [ ] 弹幕点赞和互动功能
- [ ] 管理员弹幕管理功能

### 长期规划

- [ ] 用户账号系统
- [ ] 云端设置同步
- [ ] 社区功能集成
- [ ] 更多视频格式支持
