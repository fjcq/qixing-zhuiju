# 七星追剧 - Copilot 指令

<!-- 为 Copilot 提供工作区特定的自定义指令 -->

## 项目概述

这是一个基于 Electron 的 Windows 桌面应用程序，名为"七星追剧"，用于播放苹果CMS资源站的影视节目。项目已完成清理优化，保持简洁的项目结构。

## 项目结构

```text## 注意事项

1. **GPU兼容性** - 已禁用硬件加速，避免GPU进程崩溃
2. **图标要求** - 编译需要256*256图标，界面Logo为162*58
3. **代码签名** - 已配置跳过签名避免权限问题
4. **界面优化** - 无菜单栏设计，Logo自适应显示
5. **项目清理** - 已删除所有测试文件和多余批处理文件
6. **路径处理** - 注意渲染进程中的资源路径引用
7. **线路屏蔽** - 屏蔽配置使用精确匹配，避免误伤其他线路
8. **数据导入导出** - 支持JSON格式，包含数据验证和错误处理
9. **弹幕交互优化** - 弹幕输入框使用悬停显示，避免与播放器操作冲突
10. **文档整理** - 已合并所有弹幕相关文档到单一说明文件─ src/                    # 源代码目录
│   ├── renderer/          # 渲染进程
│   │   ├── index.html     # 主窗口界面
│   │   ├── player.html    # 播放器窗口界面
│   │   ├── logo.png       # 界面Logo（162*58）
│   │   ├── css/          # 样式文件
│   │   │   ├── style.css      # 主样式
│   │   │   ├── components.css # 组件样式
│   │   │   └── routes.css     # 路由样式
│   │   └── js/           # JavaScript模块
│   │       ├── api.js         # API服务
│   │       ├── storage.js     # 本地存储
│   │       ├── components.js  # UI组件
│   │       ├── app.js         # 主应用逻辑
│   │       ├── player.js      # 播放器逻辑
│   │       ├── danmaku.js     # 弹幕系统
│   │       └── enhanced-danmaku.js # 增强版弹幕
│   └── preload.js        # 预加载脚本
├── assets/               # 资源文件
│   ├── icon.ico         # 应用图标（256*256，Windows编译用）
│   ├── icon.png         # 应用图标（256*256）
│   └── logo.png         # 应用Logo（162*58）
├── main.js              # Electron主进程
├── package.json         # 项目配置
├── build.bat           # 完整编译工具
├── dev.bat             # 开发启动工具
├── quick-build.bat     # 快速编译工具
├── README.md           # 项目文档
├── CHANGELOG.md        # 版本更新日志
└── 弹幕功能说明.md      # 弹幕使用指南
```

## 技术栈

- **Electron 27.x** - 桌面应用框架，已禁用硬件加速解决GPU问题
- **Node.js** - 运行时环境
- **HLS.js** - 视频播放库，支持m3u8格式流媒体
- **Axios** - HTTP请求库，处理API通信
- **WebSocket** - 实时通信协议，支持弹幕互动功能
- **LocalStorage** - 本地数据存储，支持配置持久化
- **原生Web技术** - HTML5/CSS3/ES6+ JavaScript
- **Electron-Packager** - 推荐的打包工具，避免代码签名问题

## 功能特性

### 核心播放功能
1. **多站点支持** - 支持多个苹果CMS API站点，兼容JSON/XML格式
2. **视频搜索** - 按关键词和分类搜索影视内容
3. **视频播放** - 支持m3u8格式的在线播放，基于HLS.js引擎
4. **播放历史** - 记录观看历史和播放进度，支持断点续播
5. **自动播放** - 支持自动播放下一集功能
6. **多窗口播放** - 独立播放器窗口，支持全屏模式

### 站点管理功能（v1.1.0新增）
7. **站点配置管理** - 添加/编辑/删除视频站点，支持批量管理
8. **线路屏蔽功能** - 支持屏蔽指定播放线路（逗号分隔多个线路）
9. **线路别名设置** - 自定义线路显示名称，提升用户体验
10. **智能线路过滤** - 自动忽略被屏蔽的播放线路

### 数据管理功能（v1.1.0新增）
11. **配置导出** - 一键导出所有设置和数据为JSON文件
12. **配置导入** - 支持合并/覆盖两种导入模式
13. **数据迁移** - 跨设备快速同步配置和设置
14. **选择性备份** - 可选择导出特定数据类型（站点/别名/历史等）

### 弹幕互动功能（v1.2.0新增）
15. **实时弹幕系统** - 基于WebSocket的实时弹幕通信
16. **双弹幕模式** - 支持实时弹幕和时间轴弹幕两种模式
17. **多彩弹幕样式** - 7种颜色、3种大小的弹幕自定义
18. **智能房间分配** - 根据视频内容自动分配弹幕房间
19. **悬停式输入** - 鼠标悬停播放器显示弹幕输入框
20. **多服务器支持** - 自动切换多个公共弹幕服务器
21. **个人标识** - 自己发送的弹幕带有绿色边框标识

### 界面美化功能（v1.2.1新增）
22. **WIN11风格圆角** - 12px统一圆角设计，现代化窗口外观
23. **自定义标题栏** - 移除系统标题栏，实现自定义窗口控制
24. **关于页面** - 完整的软件信息、更新日志和GitHub链接
25. **外部链接支持** - 安全的GitHub仓库链接跳转功能
26. **版本号同步** - 侧边栏和关于页面版本号自动同步显示

### 界面体验
22. **响应式设计** - 适配不同屏幕尺寸
23. **深色主题** - 护眼的暗色界面设计
24. **无菜单栏UI** - 简洁现代的界面设计
25. **美化的设置界面** - 优化的UI交互体验

## 开发规范

### 代码风格
- 使用ES6+语法
- 采用模块化设计
- 遵循语义化命名
- 添加适当的注释
- 优先使用const/let而非var

### 文件命名
- HTML文件使用kebab-case
- CSS类名使用kebab-case
- JavaScript变量使用camelCase
- 常量使用UPPER_SNAKE_CASE
- 批处理文件使用kebab-case

### 界面设计
- Logo尺寸：162*58像素，自适应显示
- 图标尺寸：256*256像素（编译要求）
- 深色主题设计
- 响应式布局
- 简洁无菜单栏界面

## 构建和部署

### 开发环境
```bash
npm install     # 安装依赖
npm start      # 启动开发服务器
dev.bat        # Windows批处理启动
```

### 编译发布
```bash
npm run pack        # 推荐：使用electron-packager编译
npm run dist        # electron-builder编译（可能遇到代码签名问题）
build.bat          # 完整编译（推荐）
quick-build.bat    # 快速编译
```

### 输出文件
- 编译输出：`dist/七星追剧-win32-x64/七星追剧.exe`
- 发布方式：打包整个 `七星追剧-win32-x64` 文件夹

## 技术特点

### Electron配置
- 已禁用硬件加速（解决GPU崩溃）
- 隐藏菜单栏（autoHideMenuBar + setMenuBarVisibility）
- 配置代码签名跳过
- 支持多窗口（主窗口 + 播放器窗口）

### API集成
- 所有API请求通过ApiService类处理
- 支持JSON和XML格式的苹果CMS API
- 实现错误处理和重试机制

### 数据存储
- 使用localStorage存储用户数据
- 播放历史、观看进度、用户设置等数据持久化
- 线路别名和屏蔽线路配置存储
- 支持配置数据的导入导出功能

### 播放器功能
- 基于HLS.js实现m3u8视频播放
- 支持播放进度保存和恢复
- 实现自动播放下一集功能
- 线路过滤和别名显示

### 弹幕系统（v1.2.0新增）
- 实时弹幕和时间轴弹幕双模式支持
- WebSocket实时通信，多服务器自动切换
- 智能轨道系统，最多50条弹幕同时显示
- 悬停式输入框，鼠标悬停播放器自动显示
- 支持7种颜色和3种大小的弹幕样式
- 基于视频内容的智能房间分配系统

### 站点管理（v1.1.0新增）
- 站点CRUD操作（增删改查）
- 线路屏蔽配置（支持逗号分隔多个线路）
- 线路别名管理
- 智能线路过滤逻辑

## 注意事项

1. **GPU兼容性** - 已禁用硬件加速，避免GPU进程崩溃
2. **图标要求** - 编译需要256*256图标，界面Logo为162*58
3. **代码签名** - 已配置跳过签名避免权限问题
4. **界面优化** - 无菜单栏设计，Logo自适应显示
5. **项目清理** - 已删除所有测试文件和多余批处理文件
6. **路径处理** - 注意渲染进程中的资源路径引用
7. **线路屏蔽** - 屏蔽配置使用精确匹配，避免误伤其他线路
8. **数据导入导出** - 支持JSON格式，包含数据验证和错误处理
9. **弹幕交互优化** - 弹幕输入框使用悬停显示，避免与播放器操作冲突
10. **文档整理** - 已合并所有弹幕相关文档到单一说明文件
11. **WIN11界面设计** - 当前版本v1.2.1，包含现代化圆角窗口和关于页面
12. **编译工具选择** - 推荐使用electron-packager避免代码签名问题，批处理工具已更新

## 版本更新历史

### v1.2.2 (2025-08-04)
- 🔧 修复编译图标问题，使用正确的.ico格式图标文件
- 🛠️ 优化编译工具，推荐使用electron-packager避免代码签名问题
- 📦 更新编译脚本，新增npm run pack命令
- 🔄 同步更新批处理文件和文档说明

### v1.2.1 (2025-08-03)
- 🎨 新增WIN11风格12px圆角窗口设计，现代化界面外观
- 🆕 新增关于页面，完整展示软件信息、更新日志和功能特色
- 🔗 新增GitHub仓库链接功能，支持安全的外部浏览器跳转
- 🔧 优化自定义标题栏，改进窗口控制和拖拽体验
- ✨ 增强亚克力透明效果，多层次视觉设计和圆角融合
- 🛡️ 改进外部链接安全处理，通过IPC通信确保安全性
- 📱 完善响应式布局，适配不同屏幕尺寸和分辨率

### v1.2.0 (2025-08-03)
- 🆕 新增弹幕功能，支持实时弹幕和时间轴弹幕双模式
- 🆕 新增悬停式弹幕输入，鼠标悬停播放器自动显示输入框
- 🆕 新增多彩弹幕样式，支持7种颜色和3种大小
- 🆕 新增智能弹幕房间，基于视频内容自动分配
- 🆕 新增弹幕个人标识，自己发送的弹幕带绿色边框
- 🔧 优化弹幕输入交互，解决与播放器操作的冲突
- 🔧 整理项目文档，合并所有弹幕相关说明到单一文件
- 🐛 修复播放历史存储问题，确保数据持久化保存

### v1.1.0 (2025-08-03)
- 🆕 新增线路别名功能，支持自定义线路显示名称
- 🆕 新增线路屏蔽功能，可屏蔽指定播放线路
- 🆕 新增配置导入导出功能，支持数据备份和迁移
- 🔧 优化站点管理界面，美化UI交互体验
- 🐛 修复屏蔽线路过滤逻辑，提高播放稳定性
- 📈 完善错误处理和用户反馈机制

## 开发重点

### 当前重点功能
- **弹幕互动系统** - 实时弹幕和时间轴弹幕双模式
- **悬停式交互** - 优化弹幕输入框的显示和隐藏逻辑
- **站点管理系统** - 完整的CRUD操作和配置管理
- **线路管理** - 别名设置和屏蔽功能
- **数据管理** - 导入导出和数据迁移
- **用户体验** - UI美化和交互优化

### 技术架构重点
- **模块化设计** - 清晰的代码组织和职责分离
- **WebSocket通信** - 实时弹幕系统的核心技术
- **数据持久化** - LocalStorage + JSON格式配置
- **错误处理** - 完善的异常捕获和用户反馈
- **性能优化** - 避免GPU问题，优化播放体验
- **构建优化** - 使用electron-packager避免代码签名问题
