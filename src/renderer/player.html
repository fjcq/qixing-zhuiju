<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>七星追剧 - 播放器</title>
    <link rel="stylesheet" href="css/player.css">
</head>

<body>
    <!-- 自定义标题栏 -->
    <div class="custom-titlebar">
        <div class="titlebar-drag-region">
            <span class="titlebar-title">七星追剧 - 播放器</span>
        </div>
        <div class="titlebar-controls">
            <button class="titlebar-button minimize-btn" id="minimize-btn" title="最小化">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M0 6h12" stroke="currentColor" stroke-width="1" />
                </svg>
            </button>
            <button class="titlebar-button maximize-btn" id="maximize-btn" title="最大化/还原">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M1 1h10v10H1z" fill="none" stroke="currentColor" stroke-width="1" />
                </svg>
            </button>
            <button class="titlebar-button close-btn" id="close-btn" title="关闭">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1" />
                </svg>
            </button>
        </div>
    </div>

    <div id="player-app">
        <!-- 播放器容器 - 全屏布局 -->
        <div class="player-container">
            <video id="video-player" controls autoplay>
                您的浏览器不支持视频播放。
            </video>

            <!-- 弹幕层 -->
            <div class="danmaku-container" id="danmaku-container"></div>

            <!-- 悬浮控制栏 -->
            <div class="player-overlay" id="player-overlay">
                <div class="overlay-header">
                    <div class="video-info">
                        <h3 id="video-title">视频标题</h3>
                        <span id="video-episode">正片</span>
                    </div>
                    <div class="overlay-controls">
                        <button id="toggle-danmaku" class="btn-control" title="开启/关闭弹幕">
                            <span class="icon">💬</span>
                        </button>
                        <button id="toggle-episodes" class="btn-control" title="显示/隐藏选集">
                            <span class="icon">📋</span>
                        </button>
                        <button id="toggle-always-on-top" class="btn-control" title="窗口置顶">
                            <span class="icon">📌</span>
                        </button>
                        <button id="cast-video" class="btn-control" title="投屏到电视">
                            <span class="icon">📺</span>
                        </button>
                        <button id="prev-episode" class="btn-control" disabled title="上一集">
                            <span class="icon">⏮️</span>
                        </button>
                        <button id="next-episode" class="btn-control" title="下一集">
                            <span class="icon">⏭️</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 弹幕输入区域 -->
            <div class="danmaku-input-container" id="danmaku-input-container">
                <div class="danmaku-input-panel">
                    <input type="text" id="danmaku-input" placeholder="在这里输入弹幕..." maxlength="100" />
                    <div class="danmaku-controls">
                        <select id="danmaku-color" title="弹幕颜色">
                            <option value="#ffffff">白色</option>
                            <option value="#ff0000">红色</option>
                            <option value="#ffff00">黄色</option>
                            <option value="#00ff00">绿色</option>
                            <option value="#00ffff">青色</option>
                            <option value="#0000ff">蓝色</option>
                            <option value="#ff00ff">紫色</option>
                        </select>
                        <select id="danmaku-size" title="弹幕大小">
                            <option value="small">小</option>
                            <option value="medium" selected>中</option>
                            <option value="large">大</option>
                        </select>
                        <button id="send-danmaku" class="btn-send" title="发送弹幕">发送</button>
                    </div>
                </div>
            </div>

            <!-- 加载状态 -->
            <div id="player-loading" class="player-loading hidden">
                <div class="loading-spinner"></div>
                <p>视频加载中...</p>
            </div>

            <!-- 错误状态 -->
            <div id="player-error" class="player-error hidden">
                <p>视频加载失败，请重试</p>
                <button id="retry-btn" class="btn-retry">重试</button>
            </div>

            <!-- 投屏设备选择对话框 -->
            <div class="cast-device-modal" id="cast-device-modal">
                <div class="cast-modal-backdrop"></div>
                <div class="cast-modal-content">
                    <div class="cast-modal-header">
                        <h3>选择投屏设备</h3>
                        <button class="cast-modal-close" id="cast-modal-close">
                            <span class="icon">❌</span>
                        </button>
                    </div>

                    <div class="cast-modal-body">
                        <div class="cast-scanning" id="cast-scanning">
                            <div class="cast-spinner"></div>
                            <p>正在搜索可用设备...</p>
                        </div>

                        <div class="cast-device-list" id="cast-device-list">
                            <!-- 设备列表将在这里动态生成 -->
                        </div>

                        <div class="cast-no-devices" id="cast-no-devices" style="display: none;">
                            <div class="cast-no-devices-icon">📺</div>
                            <p>未找到可用的投屏设备</p>
                            <div class="cast-tips">
                                <p>请确保：</p>
                                <ul>
                                    <li>设备和电脑在同一网络下</li>
                                    <li>投屏设备已开启投屏功能</li>
                                    <li>防火墙允许相关端口通信</li>
                                </ul>
                            </div>
                            <button class="btn-refresh-devices" id="btn-refresh-devices">
                                <span class="icon">🔄</span> 重新搜索
                            </button>
                        </div>
                    </div>

                    <div class="cast-modal-footer">
                        <button class="btn-cancel" id="cast-cancel-btn">取消</button>
                        <button class="btn-manual-cast" id="btn-manual-cast" title="手动投屏到系统默认设备">
                            <span class="icon">🖥️</span> 手动投屏
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 可收纳的选集列表 -->
        <div class="episode-panel" id="episode-panel">
            <div class="episode-panel-header">
                <h4>播放列表</h4>
                <button id="close-episodes" class="btn-panel-close" title="关闭选集面板">
                    <span class="icon">❌</span>
                </button>
            </div>

            <!-- 线路选择区域 -->
            <div class="route-selection" id="route-selection">
                <div class="route-tabs" id="route-tabs"></div>
            </div>

            <!-- 剧集列表区域 -->
            <div class="episode-list">
                <div id="episodes" class="episodes"></div>
            </div>
        </div>
    </div> <!-- 关闭 player-app -->

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="js/storage.js"></script>
    <script src="js/danmaku.js"></script>
    <script src="js/enhanced-danmaku.js"></script>
    <script src="js/player.js"></script>
</body>

</html>